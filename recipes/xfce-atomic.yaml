---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
name: xfce-atomic
description: A modern lightweight atomic desktop based on XFCE

base-image: quay.io/fedora-ostree-desktops/base-atomic
image-version: 42


modules:
  - type: files
    files:
      - source: system
        destination: /

  - type: rpm-ostree
    install:
      # Ensure that we have a kernel. Kernel packages are not in any comps group
      - kernel
      - kernel-modules
      - kernel-modules-extra
      - fedora-release-xfce
      - grub2-efi-ia32
      - grub2-efi-x64
      - grub2-pc
      - efibootmgr
      - shim-x64
      - bootc
      - dnf5
      - dnf5-plugins
      - PackageKit-glib
      # Generic release sub package for desktop variants
      - fedora-release-ostree-desktop
      # Portals for Flatpak
      - xdg-desktop-portal-gtk
      # Do not include "full" Git as it brings in Perl
      - git-core
      # Explicitely add Git docs
      - git-core-doc
      # Required until we've completed the move to systemd-sysusers
      # See: https://github.com/fedora-silverblue/issue-tracker/issues/362
      - nss-altfiles
      # Container management
      - buildah
      - podman
      - skopeo
      # Keep slirp4netns for rootless containers until it's fully deprecated in podman
      # See: https://github.com/fedora-silverblue/issue-tracker/issues/547
      - slirp4netns
      # Keep fuse-overlayfs for compatibilty and rootless containers use cases
      # See: https://github.com/coreos/fedora-coreos-tracker/issues/1749
      - fuse-overlayfs
      # See: https://github.com/fedora-silverblue/issue-tracker/issues/503
      - systemd-container
      # Provides terminal tools like clear, reset, tput, and tset
      - ncurses
      # Flatpak support
      - flatpak
      - xdg-desktop-portal
      # Contains default ostree remote config to be used on client's
      # system for fetching ostree update
      - fedora-repos-ostree
      # the archive repo for more reliable package layering
      # https://github.com/coreos/fedora-coreos-tracker/issues/400
      - fedora-repos-archive
      # Always include at least full English language support by default
      # https://gitlab.com/fedora/ostree/sig/-/issues/14
      - langpacks-en
      # Kept for backward compatibility for AppImages
      # See: https://gitlab.com/fedora/ostree/sig/-/issues/50
      - fuse
      - fuse-libs
      # Selected packages from the anaconda-tools group. See: https://gitlab.com/fedora/ostree/sig/-/issues/5
      - dosfstools
      - lvm2
      - nvme-cli
      - xfsprogs
      # HFS filesystem tools for Apple hardware
      # See https://github.com/projectatomic/rpm-ostree/issues/1380
      - hfsplus-tools
      # More printer drivers. See: https://gitlab.com/fedora/ostree/sig/-/issues/63
      - c2esp
      - dymo-cups-drivers
      - printer-driver-brlaser
      - ptouch-driver
      - splix
      - qemu-user-static
      - qemu-user-static-aarch64

  - type: script
    scripts:
      #- 00-image-info.sh
      - 01-base-main.sh
      - 02-base-packages.sh
      - 10-core.sh
      - 11-main.sh
      - 12-initramfs.yaml
      - 13-sysroot-ro.yaml
      - 14-composefs.yaml
      - 95-sanity-check.sh

  - type: signing

